!function(e,t){if("object"==typeof exports&&"object"==typeof module)module.exports=t(require("phylocanvas"));else if("function"==typeof define&&define.amd)define(["phylocanvas"],t);else{var r=t("object"==typeof exports?require("phylocanvas"):e.phylocanvas);for(var i in r)("object"==typeof exports?exports:e)[i]=r[i]}}(this,function(e){return function(e){function t(i){if(r[i])return r[i].exports;var o=r[i]={exports:{},id:i,loaded:!1};return e[i].call(o.exports,o,o.exports,t),o.loaded=!0,o.exports}var r={};return t.m=e,t.c=r,t.p="",t(0)}([function(e,t,r){"use strict";function i(e){if(Array.isArray(e)){for(var t=0,r=Array(e.length);t<e.length;t++)r[t]=e[t];return r}return Array.from(e)}function o(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}function n(e){e(this,"createTree",function(e,t){var r=e.apply(void 0,i(t)),o=s(t,2),n=o[1],a=void 0===n?{}:n;if(a.history||"undefined"==typeof a.history){var l=a.history&&"undefined"!=typeof a.history.collapsed;r.historySnapshots=[],r.history=new v(r,l?a.history.collapsed:!0)}return r}),e(l.Tree,"resizeToContainer",function(e){return this.history?void this.history.resizeTree():e.apply(this)}),this.History=v}var s=function(){function e(e,t){var r=[],i=!0,o=!1,n=void 0;try{for(var s,a=e[Symbol.iterator]();!(i=(s=a.next()).done)&&(r.push(s.value),!t||r.length!==t);i=!0);}catch(l){o=!0,n=l}finally{try{!i&&a["return"]&&a["return"]()}finally{if(o)throw n}}return r}return function(t,r){if(Array.isArray(t))return t;if(Symbol.iterator in Object(t))return e(t,r);throw new TypeError("Invalid attempt to destructure non-iterable instance")}}(),a=function(){function e(e,t){for(var r=0;r<t.length;r++){var i=t[r];i.enumerable=i.enumerable||!1,i.configurable=!0,"value"in i&&(i.writable=!0),Object.defineProperty(e,i.key,i)}}return function(t,r,i){return r&&e(t.prototype,r),i&&e(t,i),t}}();Object.defineProperty(t,"__esModule",{value:!0}),t["default"]=n;var l=r(1),d=l.utils.dom,c=d.addClass,h=d.hasClass,p=d.removeClass,u=l.utils.events,y=u.fireEvent,f=u.addEvent,g=u.killEvent,v=function(){function e(t,r){var i=this;o(this,e),this.tree=t,this.injectCss(),this.div=this.createDiv(t.containerElement),this.tree.addListener("subtree",function(e){var t=e.node;return i.addSnapshot(t)}),this.tree.addListener("loaded",function(){return i.addSnapshot(i.tree.root.id)}),this.tree.addListener("typechanged",function(){return i.addSnapshot(i.tree.root.id)}),r?this.collapse():this.expand()}return a(e,[{key:"collapse",value:function(){c(this.div,"collapsed"),this.toggleDiv.firstChild.data=">",this.resizeTree(),this.tree.draw()}},{key:"expand",value:function(){p(this.div,"collapsed"),this.toggleDiv.firstChild.data="<",this.resizeTree(),this.tree.draw()}},{key:"isCollapsed",value:function(){return h(this.div,"collapsed")}},{key:"toggle",value:function(){this.isCollapsed()?this.expand():this.collapse(),y(this.tree.containerElement,"historytoggle",{isOpen:!this.isCollapsed()})}},{key:"createDiv",value:function(e){var t=document.createElement("div");t.className="pc-history",f(t,"click",g),f(t,"contextmenu",g);var r=document.createElement("div");r.innerHTML="History",r.className="pc-history-title",t.appendChild(r);var i=document.createElement("div");i.appendChild(document.createTextNode("<")),i.className="toggle",f(i,"click",this.toggle.bind(this)),t.appendChild(i),this.toggleDiv=i;var o=document.createElement("ul");return o.className="pc-history-snapshots",t.appendChild(o),this.snapshotList=o,e.appendChild(t),t}},{key:"resizeTree",value:function(){var e=this.tree;this.width=this.div.offsetWidth,e.setSize(e.containerElement.offsetWidth-this.width,e.containerElement.offsetHeight),this.isCollapsed()?e.containerElement.getElementsByTagName("canvas")[0].style.marginLeft=this.width+"px":e.containerElement.getElementsByTagName("canvas")[0].style.marginLeft="20%"}},{key:"addSnapshot",value:function(e){if(e){var t="phylocanvas-history-",r=this.tree.treeType,i=!1;if(this.tree.historySnapshots.forEach(function(o){o.style.background="transparent",o.id===t+e&&o.getAttribute("data-tree-type")===r&&(i=!0,o.style.background="lightblue")}),!i){var o=this.tree.getPngUrl(),n=document.createElement("li"),s=document.createElement("img");s.width=this.width,s.src=o,s.id=t+e,s.setAttribute("data-tree-type",this.tree.treeType),s.style.background="lightblue",this.tree.historySnapshots.push(s),n.appendChild(s),this.snapshotList.appendChild(n),f(s,"click",this.goBackTo.bind(this))}}}},{key:"clear",value:function(){for(var e=this.snapshotList.getElementsByTagName("li"),t=e.length;t--;)this.snapshotList.removeChild(e[0]);this.tree.historySnapshots.length=0}},{key:"goBackTo",value:function(e){var t=e.target,r=t.id.replace("phylocanvas-history-","");this.tree.setTreeType(t.getAttribute("data-tree-type"),!0),this.tree.redrawFromBranch(this.tree.originalTree.branches[r])}},{key:"injectCss",value:function(){var e=".pc-history { position: absolute; top: 0; bottom: 0; left: 0; box-sizing: border-box; width: 20%; overflow: hidden; background: #EEE }.pc-history .pc-history-title { box-sizing: border-box; height: 20px; text-align: center; font-size: 13px; color: #666; padding: 2px; border-bottom: 1px solid #bbb }.pc-history .toggle { position: absolute; top: 0; right: 0; padding: 2px 8px; cursor: pointer; border-top-left-radius: 50%; border-bottom-left-radius: 50%; background-color: #666; color: #FFF; box-sizing: border-box; height: 20px; }.pc-history.collapsed .toggle { border-radius: 0 50% 50% 0 }.pc-history .toggle:hover { background-color: #FFF; color: #CCC }.pc-history.collapsed { width: 25px }.pc-history.collapsed .pc-history-snapshots { display: none }.pc-history.collapsed .pc-history-title { writing-mode: sideways-rl; -webkit-writing-mode: vertical-rl; margin-top: 30px; background: 0 0; color: #666; letter-spacing: 1.2px; border-bottom: none }.pc-history-snapshots { position: absolute; top: 20px; bottom: 0; margin: 0; padding: 0; overflow-x: hidden; overflow-y: scroll; }.pc-history-snapshots li { list-style: outside none none }.pc-history img { border: 0px solid #CCC; border-top-width: 1px; cursor: pointer; width: 100%; box-sizing: border-box; transition: background-color .25s ease; display: block }.pc-history img:hover { background-color: #fff }",t=document.head||document.getElementsByTagName("head")[0],r=document.createElement("style");r.type="text/css",r.styleSheet?r.styleSheet.cssText=e:r.appendChild(document.createTextNode(e)),t.appendChild(r)}}]),e}()},function(t,r){t.exports=e}])});